{"remainingRequest":"/Users/yanagi/programming/live-chat-vuejs/node_modules/babel-loader/lib/index.js!/Users/yanagi/programming/live-chat-vuejs/node_modules/cache-loader/dist/cjs.js??ref--1-0!/Users/yanagi/programming/live-chat-vuejs/node_modules/vue-loader-v16/dist/index.js??ref--1-1!/Users/yanagi/programming/live-chat-vuejs/src/views/Chatroom.vue?vue&type=script&lang=js","dependencies":[{"path":"/Users/yanagi/programming/live-chat-vuejs/src/views/Chatroom.vue","mtime":1638956394240},{"path":"/Users/yanagi/programming/live-chat-vuejs/babel.config.js","mtime":1637909021919},{"path":"/Users/yanagi/programming/live-chat-vuejs/node_modules/cache-loader/dist/cjs.js","mtime":1637908768660},{"path":"/Users/yanagi/programming/live-chat-vuejs/node_modules/babel-loader/lib/index.js","mtime":1637908770962},{"path":"/Users/yanagi/programming/live-chat-vuejs/node_modules/cache-loader/dist/cjs.js","mtime":1637908768660},{"path":"/Users/yanagi/programming/live-chat-vuejs/node_modules/vue-loader-v16/dist/index.js","mtime":1637908768201}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:aW1wb3J0IF9hc3luY1RvR2VuZXJhdG9yIGZyb20gIi9Vc2Vycy95YW5hZ2kvcHJvZ3JhbW1pbmcvbGl2ZS1jaGF0LXZ1ZWpzL25vZGVfbW9kdWxlcy9AYmFiZWwvcnVudGltZS9oZWxwZXJzL2VzbS9hc3luY1RvR2VuZXJhdG9yLmpzIjsKaW1wb3J0IF9vYmplY3RTcHJlYWQgZnJvbSAiL1VzZXJzL3lhbmFnaS9wcm9ncmFtbWluZy9saXZlLWNoYXQtdnVlanMvbm9kZV9tb2R1bGVzL0BiYWJlbC9ydW50aW1lL2hlbHBlcnMvZXNtL29iamVjdFNwcmVhZDIuanMiOwppbXBvcnQgInJlZ2VuZXJhdG9yLXJ1bnRpbWUvcnVudGltZS5qcyI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL2VzLmFycmF5Lm1hcC5qcyI7CmltcG9ydCBOYXZiYXIgZnJvbSAnLi4vY29tcG9uZW50cy9OYXZiYXInOwppbXBvcnQgQ2hhdFdpbmRvdyBmcm9tICcuLi9jb21wb25lbnRzL0NoYXRXaW5kb3cnOwppbXBvcnQgTmV3Q2hhdEZvcm0gZnJvbSAnLi4vY29tcG9uZW50cy9OZXdDaGF0Rm9ybSc7CmltcG9ydCBheGlvcyBmcm9tICdheGlvcyc7CmltcG9ydCBBY3Rpb25DYWJsZSBmcm9tICdhY3Rpb25jYWJsZSc7CmltcG9ydCB7IGZvcm1hdERpc3RhbmNlVG9Ob3cgfSBmcm9tICdkYXRlLWZucyc7CmltcG9ydCB7IGphIH0gZnJvbSAnZGF0ZS1mbnMvbG9jYWxlJzsKZXhwb3J0IGRlZmF1bHQgewogIGNvbXBvbmVudHM6IHsKICAgIE5hdmJhcjogTmF2YmFyLAogICAgQ2hhdFdpbmRvdzogQ2hhdFdpbmRvdywKICAgIE5ld0NoYXRGb3JtOiBOZXdDaGF0Rm9ybQogIH0sCiAgZGF0YTogZnVuY3Rpb24gZGF0YSgpIHsKICAgIHJldHVybiB7CiAgICAgIG1lc3NhZ2VzOiBbXQogICAgfTsKICB9LAogIGNvbXB1dGVkOiB7CiAgICBmb3JtYXR0ZWRNZXNzYWdlczogZnVuY3Rpb24gZm9ybWF0dGVkTWVzc2FnZXMoKSB7CiAgICAgIGlmICghdGhpcy5tZXNzYWdlcy5sZW5ndGgpIHsKICAgICAgICByZXR1cm4gW107CiAgICAgIH0KCiAgICAgIHJldHVybiB0aGlzLm1lc3NhZ2VzLm1hcChmdW5jdGlvbiAobWVzc2FnZSkgewogICAgICAgIHZhciB0aW1lID0gZm9ybWF0RGlzdGFuY2VUb05vdyhuZXcgRGF0ZShtZXNzYWdlLmNyZWF0ZWRfYXQpLCB7CiAgICAgICAgICBsb2NhbGU6IGphCiAgICAgICAgfSk7CiAgICAgICAgcmV0dXJuIF9vYmplY3RTcHJlYWQoX29iamVjdFNwcmVhZCh7fSwgbWVzc2FnZSksIHt9LCB7CiAgICAgICAgICBjcmVhdGVkX2F0OiB0aW1lCiAgICAgICAgfSk7CiAgICAgIH0pOwogICAgfQogIH0sCiAgbWV0aG9kczogewogICAgZ2V0TWVzc2FnZXM6IGZ1bmN0aW9uIGdldE1lc3NhZ2VzKCkgewogICAgICB2YXIgX3RoaXMgPSB0aGlzOwoKICAgICAgcmV0dXJuIF9hc3luY1RvR2VuZXJhdG9yKCAvKiNfX1BVUkVfXyovcmVnZW5lcmF0b3JSdW50aW1lLm1hcmsoZnVuY3Rpb24gX2NhbGxlZSgpIHsKICAgICAgICB2YXIgcmVzOwogICAgICAgIHJldHVybiByZWdlbmVyYXRvclJ1bnRpbWUud3JhcChmdW5jdGlvbiBfY2FsbGVlJChfY29udGV4dCkgewogICAgICAgICAgd2hpbGUgKDEpIHsKICAgICAgICAgICAgc3dpdGNoIChfY29udGV4dC5wcmV2ID0gX2NvbnRleHQubmV4dCkgewogICAgICAgICAgICAgIGNhc2UgMDoKICAgICAgICAgICAgICAgIF9jb250ZXh0LnByZXYgPSAwOwogICAgICAgICAgICAgICAgX2NvbnRleHQubmV4dCA9IDM7CiAgICAgICAgICAgICAgICByZXR1cm4gYXhpb3MuZ2V0KCdodHRwOi8vbG9jYWxob3N0OjMwMDAvbWVzc2FnZXMnLCB7CiAgICAgICAgICAgICAgICAgIGhlYWRlcnM6IHsKICAgICAgICAgICAgICAgICAgICB1aWQ6IHdpbmRvdy5sb2NhbFN0b3JhZ2UuZ2V0SXRlbSgndWlkJyksCiAgICAgICAgICAgICAgICAgICAgImFjY2Vzcy10b2tlbiI6IHdpbmRvdy5sb2NhbFN0b3JhZ2UuZ2V0SXRlbSgnYWNjZXNzLXRva2VuJyksCiAgICAgICAgICAgICAgICAgICAgY2xpZW50OiB3aW5kb3cubG9jYWxTdG9yYWdlLmdldEl0ZW0oJ2NsaWVudCcpCiAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0pOwoKICAgICAgICAgICAgICBjYXNlIDM6CiAgICAgICAgICAgICAgICByZXMgPSBfY29udGV4dC5zZW50OwoKICAgICAgICAgICAgICAgIGlmICghcmVzKSB7CiAgICAgICAgICAgICAgICAgIG5ldyBFcnJvcign44Oh44OD44K744O844K45LiA6Kan44KS5Y+W5b6X44Gn44GN44G+44Gb44KT44Gn44GX44GfJyk7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgX3RoaXMubWVzc2FnZXMgPSByZXMuZGF0YTsKICAgICAgICAgICAgICAgIF9jb250ZXh0Lm5leHQgPSAxMTsKICAgICAgICAgICAgICAgIGJyZWFrOwoKICAgICAgICAgICAgICBjYXNlIDg6CiAgICAgICAgICAgICAgICBfY29udGV4dC5wcmV2ID0gODsKICAgICAgICAgICAgICAgIF9jb250ZXh0LnQwID0gX2NvbnRleHRbImNhdGNoIl0oMCk7CiAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhfY29udGV4dC50MCk7CgogICAgICAgICAgICAgIGNhc2UgMTE6CiAgICAgICAgICAgICAgY2FzZSAiZW5kIjoKICAgICAgICAgICAgICAgIHJldHVybiBfY29udGV4dC5zdG9wKCk7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9LCBfY2FsbGVlLCBudWxsLCBbWzAsIDhdXSk7CiAgICAgIH0pKSgpOwogICAgfSwKICAgIGNvbm5lY3RDYWJsZTogZnVuY3Rpb24gY29ubmVjdENhYmxlKG1lc3NhZ2UpIHsKICAgICAgdGhpcy5tZXNzYWdlQ2hhbm5lbC5wZXJmb3JtKCdyZWNlaXZlJywgewogICAgICAgIG1lc3NhZ2U6IG1lc3NhZ2UsCiAgICAgICAgZW1haWw6IHdpbmRvdy5sb2NhbFN0b3JhZ2UuZ2V0SXRlbSgndWlkJykKICAgICAgfSk7CiAgICB9CiAgfSwKICBtb3VudGVkOiBmdW5jdGlvbiBtb3VudGVkKCkgewogICAgdmFyIF90aGlzMiA9IHRoaXM7CgogICAgdmFyIGNhYmxlID0gQWN0aW9uQ2FibGUuY3JlYXRlQ29uc3VtZXIoJ3dzOi8vbG9jYWxob3N0OjMwMDAvY2FibGUnKTsKICAgIHRoaXMubWVzc2FnZUNoYW5uZWwgPSBjYWJsZS5zdWJzY3JpcHRpb25zLmNyZWF0ZSgnUm9vbUNoYW5uZWwnLCB7CiAgICAgIGNvbm5lY3RlZDogZnVuY3Rpb24gY29ubmVjdGVkKCkgewogICAgICAgIF90aGlzMi5nZXRNZXNzYWdlcygpLnRoZW4oZnVuY3Rpb24gKCkgewogICAgICAgICAgX3RoaXMyLiRyZWZzLmNoYXRXaW5kb3cuc2Nyb2xsVG9Cb3R0b20oKTsKICAgICAgICB9KTsKICAgICAgfSwKICAgICAgcmVjZWl2ZWQ6IGZ1bmN0aW9uIHJlY2VpdmVkKCkgewogICAgICAgIF90aGlzMi5nZXRNZXNzYWdlcygpLnRoZW4oZnVuY3Rpb24gKCkgewogICAgICAgICAgX3RoaXMyLiRyZWZzLmNoYXRXaW5kb3cuc2Nyb2xsVG9Cb3R0b20oKTsKICAgICAgICB9KTsKICAgICAgfQogICAgfSk7CiAgfSwKICBiZWZvcmVVbm1vdW50OiBmdW5jdGlvbiBiZWZvcmVVbm1vdW50KCkgewogICAgdGhpcy5tZXNzYWdlQ2hhbm5lbC51bnN1YnNjcmliZSgpOwogIH0KfTs="},{"version":3,"sources":["/Users/yanagi/programming/live-chat-vuejs/src/views/Chatroom.vue"],"names":[],"mappings":"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","sourcesContent":["<template>\n  <div class=\"container\">\n    <Navbar />\n    <ChatWindow @connectCable=\"connectCable\" :messages=\"formattedMessages\" ref=\"chatWindow\" />\n    <NewChatForm @connectCable=\"connectCable\"/>\n  </div>\n</template>\n\n<script>\nimport Navbar from '../components/Navbar'\nimport ChatWindow from '../components/ChatWindow'\nimport NewChatForm from '../components/NewChatForm'\nimport axios from 'axios'\nimport ActionCable from 'actioncable'\nimport { formatDistanceToNow } from 'date-fns'\nimport { ja } from 'date-fns/locale'\n\nexport default {\n  components: { Navbar, ChatWindow, NewChatForm },\n  data () {\n    return {\n      messages: [],\n    }\n  },\n  computed: {\n    formattedMessages() {\n      if (!this.messages.length) { return [] }\n      return this.messages.map(message => {\n        let time = formatDistanceToNow(new Date(message.created_at), { locale: ja })\n        return { ...message, created_at: time }\n      })\n    }\n  },\n  methods: {\n    async getMessages () {\n      try {\n        const res = await axios.get('http://localhost:3000/messages', {\n          headers: {\n            uid: window.localStorage.getItem('uid'),\n            \"access-token\": window.localStorage.getItem('access-token'),\n            client:window.localStorage.getItem('client')\n          }\n        })\n        if (!res) {\n          new Error('メッセージ一覧を取得できませんでした')\n        }\n        this.messages = res.data\n      } catch (err) {\n        console.log(err)\n      }\n    },\n\n    connectCable (message) {\n      this.messageChannel.perform('receive', {\n        message: message,\n        email: window.localStorage.getItem('uid')\n      })\n    }\n  },\n  mounted() {\n    const cable = ActionCable.createConsumer('ws://localhost:3000/cable')\n    this.messageChannel = cable.subscriptions.create('RoomChannel', {\n      connected: () => {\n        this.getMessages().then(() => {\n          this.$refs.chatWindow.scrollToBottom()\n        })\n      },\n      received: () => {\n        this.getMessages().then(() => {\n          this.$refs.chatWindow.scrollToBottom()\n        })\n      }\n    })\n  },\n  beforeUnmount () {\n    this.messageChannel.unsubscribe()\n  }\n}\n</script>\n\n<style lang=\"css\" scoped>\n</style>\n"],"sourceRoot":""}]}