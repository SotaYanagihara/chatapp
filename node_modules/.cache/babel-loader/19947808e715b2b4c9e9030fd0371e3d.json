{"remainingRequest":"/Users/yanagi/chatapp/live-chat-rails/node_modules/babel-loader/lib/index.js!/Users/yanagi/chatapp/live-chat-rails/node_modules/cache-loader/dist/cjs.js??ref--1-0!/Users/yanagi/chatapp/live-chat-rails/node_modules/vue-loader-v16/dist/index.js??ref--1-1!/Users/yanagi/chatapp/live-chat-rails/src/views/Chatroom.vue?vue&type=script&lang=js","dependencies":[{"path":"/Users/yanagi/chatapp/live-chat-rails/src/views/Chatroom.vue","mtime":1638956394240},{"path":"/Users/yanagi/chatapp/live-chat-rails/babel.config.js","mtime":1637909021919},{"path":"/Users/yanagi/chatapp/live-chat-rails/node_modules/cache-loader/dist/cjs.js","mtime":1637908768660},{"path":"/Users/yanagi/chatapp/live-chat-rails/node_modules/babel-loader/lib/index.js","mtime":1637908770962},{"path":"/Users/yanagi/chatapp/live-chat-rails/node_modules/cache-loader/dist/cjs.js","mtime":1637908768660},{"path":"/Users/yanagi/chatapp/live-chat-rails/node_modules/vue-loader-v16/dist/index.js","mtime":1637908768201}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:aW1wb3J0IF9hc3luY1RvR2VuZXJhdG9yIGZyb20gIi9Vc2Vycy95YW5hZ2kvY2hhdGFwcC9saXZlLWNoYXQtcmFpbHMvbm9kZV9tb2R1bGVzL0BiYWJlbC9ydW50aW1lL2hlbHBlcnMvZXNtL2FzeW5jVG9HZW5lcmF0b3IuanMiOwppbXBvcnQgX29iamVjdFNwcmVhZCBmcm9tICIvVXNlcnMveWFuYWdpL2NoYXRhcHAvbGl2ZS1jaGF0LXJhaWxzL25vZGVfbW9kdWxlcy9AYmFiZWwvcnVudGltZS9oZWxwZXJzL2VzbS9vYmplY3RTcHJlYWQyLmpzIjsKaW1wb3J0ICJyZWdlbmVyYXRvci1ydW50aW1lL3J1bnRpbWUuanMiOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy5hcnJheS5tYXAuanMiOwppbXBvcnQgTmF2YmFyIGZyb20gJy4uL2NvbXBvbmVudHMvTmF2YmFyJzsKaW1wb3J0IENoYXRXaW5kb3cgZnJvbSAnLi4vY29tcG9uZW50cy9DaGF0V2luZG93JzsKaW1wb3J0IE5ld0NoYXRGb3JtIGZyb20gJy4uL2NvbXBvbmVudHMvTmV3Q2hhdEZvcm0nOwppbXBvcnQgYXhpb3MgZnJvbSAnYXhpb3MnOwppbXBvcnQgQWN0aW9uQ2FibGUgZnJvbSAnYWN0aW9uY2FibGUnOwppbXBvcnQgeyBmb3JtYXREaXN0YW5jZVRvTm93IH0gZnJvbSAnZGF0ZS1mbnMnOwppbXBvcnQgeyBqYSB9IGZyb20gJ2RhdGUtZm5zL2xvY2FsZSc7CmV4cG9ydCBkZWZhdWx0IHsKICBjb21wb25lbnRzOiB7CiAgICBOYXZiYXI6IE5hdmJhciwKICAgIENoYXRXaW5kb3c6IENoYXRXaW5kb3csCiAgICBOZXdDaGF0Rm9ybTogTmV3Q2hhdEZvcm0KICB9LAogIGRhdGE6IGZ1bmN0aW9uIGRhdGEoKSB7CiAgICByZXR1cm4gewogICAgICBtZXNzYWdlczogW10KICAgIH07CiAgfSwKICBjb21wdXRlZDogewogICAgZm9ybWF0dGVkTWVzc2FnZXM6IGZ1bmN0aW9uIGZvcm1hdHRlZE1lc3NhZ2VzKCkgewogICAgICBpZiAoIXRoaXMubWVzc2FnZXMubGVuZ3RoKSB7CiAgICAgICAgcmV0dXJuIFtdOwogICAgICB9CgogICAgICByZXR1cm4gdGhpcy5tZXNzYWdlcy5tYXAoZnVuY3Rpb24gKG1lc3NhZ2UpIHsKICAgICAgICB2YXIgdGltZSA9IGZvcm1hdERpc3RhbmNlVG9Ob3cobmV3IERhdGUobWVzc2FnZS5jcmVhdGVkX2F0KSwgewogICAgICAgICAgbG9jYWxlOiBqYQogICAgICAgIH0pOwogICAgICAgIHJldHVybiBfb2JqZWN0U3ByZWFkKF9vYmplY3RTcHJlYWQoe30sIG1lc3NhZ2UpLCB7fSwgewogICAgICAgICAgY3JlYXRlZF9hdDogdGltZQogICAgICAgIH0pOwogICAgICB9KTsKICAgIH0KICB9LAogIG1ldGhvZHM6IHsKICAgIGdldE1lc3NhZ2VzOiBmdW5jdGlvbiBnZXRNZXNzYWdlcygpIHsKICAgICAgdmFyIF90aGlzID0gdGhpczsKCiAgICAgIHJldHVybiBfYXN5bmNUb0dlbmVyYXRvciggLyojX19QVVJFX18qL3JlZ2VuZXJhdG9yUnVudGltZS5tYXJrKGZ1bmN0aW9uIF9jYWxsZWUoKSB7CiAgICAgICAgdmFyIHJlczsKICAgICAgICByZXR1cm4gcmVnZW5lcmF0b3JSdW50aW1lLndyYXAoZnVuY3Rpb24gX2NhbGxlZSQoX2NvbnRleHQpIHsKICAgICAgICAgIHdoaWxlICgxKSB7CiAgICAgICAgICAgIHN3aXRjaCAoX2NvbnRleHQucHJldiA9IF9jb250ZXh0Lm5leHQpIHsKICAgICAgICAgICAgICBjYXNlIDA6CiAgICAgICAgICAgICAgICBfY29udGV4dC5wcmV2ID0gMDsKICAgICAgICAgICAgICAgIF9jb250ZXh0Lm5leHQgPSAzOwogICAgICAgICAgICAgICAgcmV0dXJuIGF4aW9zLmdldCgnaHR0cDovL2xvY2FsaG9zdDozMDAwL21lc3NhZ2VzJywgewogICAgICAgICAgICAgICAgICBoZWFkZXJzOiB7CiAgICAgICAgICAgICAgICAgICAgdWlkOiB3aW5kb3cubG9jYWxTdG9yYWdlLmdldEl0ZW0oJ3VpZCcpLAogICAgICAgICAgICAgICAgICAgICJhY2Nlc3MtdG9rZW4iOiB3aW5kb3cubG9jYWxTdG9yYWdlLmdldEl0ZW0oJ2FjY2Vzcy10b2tlbicpLAogICAgICAgICAgICAgICAgICAgIGNsaWVudDogd2luZG93LmxvY2FsU3RvcmFnZS5nZXRJdGVtKCdjbGllbnQnKQogICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9KTsKCiAgICAgICAgICAgICAgY2FzZSAzOgogICAgICAgICAgICAgICAgcmVzID0gX2NvbnRleHQuc2VudDsKCiAgICAgICAgICAgICAgICBpZiAoIXJlcykgewogICAgICAgICAgICAgICAgICBuZXcgRXJyb3IoJ+ODoeODg+OCu+ODvOOCuOS4gOimp+OCkuWPluW+l+OBp+OBjeOBvuOBm+OCk+OBp+OBl+OBnycpOwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIF90aGlzLm1lc3NhZ2VzID0gcmVzLmRhdGE7CiAgICAgICAgICAgICAgICBfY29udGV4dC5uZXh0ID0gMTE7CiAgICAgICAgICAgICAgICBicmVhazsKCiAgICAgICAgICAgICAgY2FzZSA4OgogICAgICAgICAgICAgICAgX2NvbnRleHQucHJldiA9IDg7CiAgICAgICAgICAgICAgICBfY29udGV4dC50MCA9IF9jb250ZXh0WyJjYXRjaCJdKDApOwogICAgICAgICAgICAgICAgY29uc29sZS5sb2coX2NvbnRleHQudDApOwoKICAgICAgICAgICAgICBjYXNlIDExOgogICAgICAgICAgICAgIGNhc2UgImVuZCI6CiAgICAgICAgICAgICAgICByZXR1cm4gX2NvbnRleHQuc3RvcCgpOwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfSwgX2NhbGxlZSwgbnVsbCwgW1swLCA4XV0pOwogICAgICB9KSkoKTsKICAgIH0sCiAgICBjb25uZWN0Q2FibGU6IGZ1bmN0aW9uIGNvbm5lY3RDYWJsZShtZXNzYWdlKSB7CiAgICAgIHRoaXMubWVzc2FnZUNoYW5uZWwucGVyZm9ybSgncmVjZWl2ZScsIHsKICAgICAgICBtZXNzYWdlOiBtZXNzYWdlLAogICAgICAgIGVtYWlsOiB3aW5kb3cubG9jYWxTdG9yYWdlLmdldEl0ZW0oJ3VpZCcpCiAgICAgIH0pOwogICAgfQogIH0sCiAgbW91bnRlZDogZnVuY3Rpb24gbW91bnRlZCgpIHsKICAgIHZhciBfdGhpczIgPSB0aGlzOwoKICAgIHZhciBjYWJsZSA9IEFjdGlvbkNhYmxlLmNyZWF0ZUNvbnN1bWVyKCd3czovL2xvY2FsaG9zdDozMDAwL2NhYmxlJyk7CiAgICB0aGlzLm1lc3NhZ2VDaGFubmVsID0gY2FibGUuc3Vic2NyaXB0aW9ucy5jcmVhdGUoJ1Jvb21DaGFubmVsJywgewogICAgICBjb25uZWN0ZWQ6IGZ1bmN0aW9uIGNvbm5lY3RlZCgpIHsKICAgICAgICBfdGhpczIuZ2V0TWVzc2FnZXMoKS50aGVuKGZ1bmN0aW9uICgpIHsKICAgICAgICAgIF90aGlzMi4kcmVmcy5jaGF0V2luZG93LnNjcm9sbFRvQm90dG9tKCk7CiAgICAgICAgfSk7CiAgICAgIH0sCiAgICAgIHJlY2VpdmVkOiBmdW5jdGlvbiByZWNlaXZlZCgpIHsKICAgICAgICBfdGhpczIuZ2V0TWVzc2FnZXMoKS50aGVuKGZ1bmN0aW9uICgpIHsKICAgICAgICAgIF90aGlzMi4kcmVmcy5jaGF0V2luZG93LnNjcm9sbFRvQm90dG9tKCk7CiAgICAgICAgfSk7CiAgICAgIH0KICAgIH0pOwogIH0sCiAgYmVmb3JlVW5tb3VudDogZnVuY3Rpb24gYmVmb3JlVW5tb3VudCgpIHsKICAgIHRoaXMubWVzc2FnZUNoYW5uZWwudW5zdWJzY3JpYmUoKTsKICB9Cn07"},{"version":3,"sources":["/Users/yanagi/chatapp/live-chat-rails/src/views/Chatroom.vue"],"names":[],"mappings":"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","sourcesContent":["<template>\n  <div class=\"container\">\n    <Navbar />\n    <ChatWindow @connectCable=\"connectCable\" :messages=\"formattedMessages\" ref=\"chatWindow\" />\n    <NewChatForm @connectCable=\"connectCable\"/>\n  </div>\n</template>\n\n<script>\nimport Navbar from '../components/Navbar'\nimport ChatWindow from '../components/ChatWindow'\nimport NewChatForm from '../components/NewChatForm'\nimport axios from 'axios'\nimport ActionCable from 'actioncable'\nimport { formatDistanceToNow } from 'date-fns'\nimport { ja } from 'date-fns/locale'\n\nexport default {\n  components: { Navbar, ChatWindow, NewChatForm },\n  data () {\n    return {\n      messages: [],\n    }\n  },\n  computed: {\n    formattedMessages() {\n      if (!this.messages.length) { return [] }\n      return this.messages.map(message => {\n        let time = formatDistanceToNow(new Date(message.created_at), { locale: ja })\n        return { ...message, created_at: time }\n      })\n    }\n  },\n  methods: {\n    async getMessages () {\n      try {\n        const res = await axios.get('http://localhost:3000/messages', {\n          headers: {\n            uid: window.localStorage.getItem('uid'),\n            \"access-token\": window.localStorage.getItem('access-token'),\n            client:window.localStorage.getItem('client')\n          }\n        })\n        if (!res) {\n          new Error('メッセージ一覧を取得できませんでした')\n        }\n        this.messages = res.data\n      } catch (err) {\n        console.log(err)\n      }\n    },\n\n    connectCable (message) {\n      this.messageChannel.perform('receive', {\n        message: message,\n        email: window.localStorage.getItem('uid')\n      })\n    }\n  },\n  mounted() {\n    const cable = ActionCable.createConsumer('ws://localhost:3000/cable')\n    this.messageChannel = cable.subscriptions.create('RoomChannel', {\n      connected: () => {\n        this.getMessages().then(() => {\n          this.$refs.chatWindow.scrollToBottom()\n        })\n      },\n      received: () => {\n        this.getMessages().then(() => {\n          this.$refs.chatWindow.scrollToBottom()\n        })\n      }\n    })\n  },\n  beforeUnmount () {\n    this.messageChannel.unsubscribe()\n  }\n}\n</script>\n\n<style lang=\"css\" scoped>\n</style>\n"],"sourceRoot":""}]}