{"remainingRequest":"/Users/yanagi/chatapp/live-chat-rails/node_modules/babel-loader/lib/index.js!/Users/yanagi/chatapp/live-chat-rails/node_modules/cache-loader/dist/cjs.js??ref--1-0!/Users/yanagi/chatapp/live-chat-rails/node_modules/vue-loader-v16/dist/index.js??ref--1-1!/Users/yanagi/chatapp/live-chat-rails/src/components/ChatWindow.vue?vue&type=script&lang=js","dependencies":[{"path":"/Users/yanagi/chatapp/live-chat-rails/src/components/ChatWindow.vue","mtime":1638956028302},{"path":"/Users/yanagi/chatapp/live-chat-rails/babel.config.js","mtime":1637909021919},{"path":"/Users/yanagi/chatapp/live-chat-rails/node_modules/cache-loader/dist/cjs.js","mtime":1637908768660},{"path":"/Users/yanagi/chatapp/live-chat-rails/node_modules/babel-loader/lib/index.js","mtime":1637908770962},{"path":"/Users/yanagi/chatapp/live-chat-rails/node_modules/cache-loader/dist/cjs.js","mtime":1637908768660},{"path":"/Users/yanagi/chatapp/live-chat-rails/node_modules/vue-loader-v16/dist/index.js","mtime":1637908768201}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:aW1wb3J0IF9hc3luY1RvR2VuZXJhdG9yIGZyb20gIi9Vc2Vycy95YW5hZ2kvY2hhdGFwcC9saXZlLWNoYXQtcmFpbHMvbm9kZV9tb2R1bGVzL0BiYWJlbC9ydW50aW1lL2hlbHBlcnMvZXNtL2FzeW5jVG9HZW5lcmF0b3IuanMiOwppbXBvcnQgInJlZ2VuZXJhdG9yLXJ1bnRpbWUvcnVudGltZS5qcyI7CmltcG9ydCBheGlvcyBmcm9tICdheGlvcyc7CmV4cG9ydCBkZWZhdWx0IHsKICBlbWl0czogWydjb25uZWN0Q2FibGUnXSwKICBwcm9wczogWydtZXNzYWdlcyddLAogIGRhdGE6IGZ1bmN0aW9uIGRhdGEoKSB7CiAgICByZXR1cm4gewogICAgICB1aWQ6IGxvY2FsU3RvcmFnZS5nZXRJdGVtKCd1aWQnKQogICAgfTsKICB9LAogIG1ldGhvZHM6IHsKICAgIGhhbmRsZUxpa2U6IGZ1bmN0aW9uIGhhbmRsZUxpa2UobWVzc2FnZSkgewogICAgICBmb3IgKHZhciBpID0gMDsgaSA8IG1lc3NhZ2UubGlrZXMubGVuZ3RoOyBpKyspIHsKICAgICAgICB2YXIgbGlrZSA9IG1lc3NhZ2UubGlrZXNbaV07CgogICAgICAgIGlmIChsaWtlLmVtYWlsID09PSB0aGlzLnVpZCkgewogICAgICAgICAgdGhpcy5kZWxldGVMaWtlKGxpa2UuaWQsIG1lc3NhZ2UuaWQpOwogICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KICAgICAgfQoKICAgICAgdGhpcy5jcmVhdGVMaWtlKG1lc3NhZ2UuaWQpOwogICAgfSwKICAgIGNyZWF0ZUxpa2U6IGZ1bmN0aW9uIGNyZWF0ZUxpa2UobWVzc2FnZUlkKSB7CiAgICAgIHZhciBfdGhpcyA9IHRoaXM7CgogICAgICByZXR1cm4gX2FzeW5jVG9HZW5lcmF0b3IoIC8qI19fUFVSRV9fKi9yZWdlbmVyYXRvclJ1bnRpbWUubWFyayhmdW5jdGlvbiBfY2FsbGVlKCkgewogICAgICAgIHZhciByZXM7CiAgICAgICAgcmV0dXJuIHJlZ2VuZXJhdG9yUnVudGltZS53cmFwKGZ1bmN0aW9uIF9jYWxsZWUkKF9jb250ZXh0KSB7CiAgICAgICAgICB3aGlsZSAoMSkgewogICAgICAgICAgICBzd2l0Y2ggKF9jb250ZXh0LnByZXYgPSBfY29udGV4dC5uZXh0KSB7CiAgICAgICAgICAgICAgY2FzZSAwOgogICAgICAgICAgICAgICAgX2NvbnRleHQucHJldiA9IDA7CiAgICAgICAgICAgICAgICBfY29udGV4dC5uZXh0ID0gMzsKICAgICAgICAgICAgICAgIHJldHVybiBheGlvcy5wb3N0KCJodHRwOi8vbG9jYWxob3N0OjMwMDAvbWVzc2FnZXMvIi5jb25jYXQobWVzc2FnZUlkLCAiL2xpa2VzIiksIHt9LCB7CiAgICAgICAgICAgICAgICAgIGhlYWRlcnM6IHsKICAgICAgICAgICAgICAgICAgICB1aWQ6IF90aGlzLnVpZCwKICAgICAgICAgICAgICAgICAgICAiYWNjZXNzLXRva2VuIjogd2luZG93LmxvY2FsU3RvcmFnZS5nZXRJdGVtKCdhY2Nlc3MtdG9rZW4nKSwKICAgICAgICAgICAgICAgICAgICBjbGllbnQ6IHdpbmRvdy5sb2NhbFN0b3JhZ2UuZ2V0SXRlbSgnY2xpZW50JykKICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfSk7CgogICAgICAgICAgICAgIGNhc2UgMzoKICAgICAgICAgICAgICAgIHJlcyA9IF9jb250ZXh0LnNlbnQ7CgogICAgICAgICAgICAgICAgaWYgKCFyZXMpIHsKICAgICAgICAgICAgICAgICAgbmV3IEVycm9yKCfjgYTjgYTjga3jgafjgY3jgb7jgZvjgpPjgafjgZfjgZ8nKTsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICBfdGhpcy4kZW1pdCgnY29ubmVjdENhYmxlJyk7CgogICAgICAgICAgICAgICAgX2NvbnRleHQubmV4dCA9IDExOwogICAgICAgICAgICAgICAgYnJlYWs7CgogICAgICAgICAgICAgIGNhc2UgODoKICAgICAgICAgICAgICAgIF9jb250ZXh0LnByZXYgPSA4OwogICAgICAgICAgICAgICAgX2NvbnRleHQudDAgPSBfY29udGV4dFsiY2F0Y2giXSgwKTsKICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKF9jb250ZXh0LnQwKTsKCiAgICAgICAgICAgICAgY2FzZSAxMToKICAgICAgICAgICAgICBjYXNlICJlbmQiOgogICAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0LnN0b3AoKTsKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0sIF9jYWxsZWUsIG51bGwsIFtbMCwgOF1dKTsKICAgICAgfSkpKCk7CiAgICB9LAogICAgZGVsZXRlTGlrZTogZnVuY3Rpb24gZGVsZXRlTGlrZShsaWtlSWQpIHsKICAgICAgdmFyIF90aGlzMiA9IHRoaXM7CgogICAgICByZXR1cm4gX2FzeW5jVG9HZW5lcmF0b3IoIC8qI19fUFVSRV9fKi9yZWdlbmVyYXRvclJ1bnRpbWUubWFyayhmdW5jdGlvbiBfY2FsbGVlMigpIHsKICAgICAgICB2YXIgcmVzOwogICAgICAgIHJldHVybiByZWdlbmVyYXRvclJ1bnRpbWUud3JhcChmdW5jdGlvbiBfY2FsbGVlMiQoX2NvbnRleHQyKSB7CiAgICAgICAgICB3aGlsZSAoMSkgewogICAgICAgICAgICBzd2l0Y2ggKF9jb250ZXh0Mi5wcmV2ID0gX2NvbnRleHQyLm5leHQpIHsKICAgICAgICAgICAgICBjYXNlIDA6CiAgICAgICAgICAgICAgICBfY29udGV4dDIucHJldiA9IDA7CiAgICAgICAgICAgICAgICBfY29udGV4dDIubmV4dCA9IDM7CiAgICAgICAgICAgICAgICByZXR1cm4gYXhpb3MuZGVsZXRlKCJodHRwOi8vbG9jYWxob3N0OjMwMDAvbGlrZXMvIi5jb25jYXQobGlrZUlkKSwgewogICAgICAgICAgICAgICAgICBoZWFkZXJzOiB7CiAgICAgICAgICAgICAgICAgICAgdWlkOiBfdGhpczIudWlkLAogICAgICAgICAgICAgICAgICAgICJhY2Nlc3MtdG9rZW4iOiB3aW5kb3cubG9jYWxTdG9yYWdlLmdldEl0ZW0oJ2FjY2Vzcy10b2tlbicpLAogICAgICAgICAgICAgICAgICAgIGNsaWVudDogd2luZG93LmxvY2FsU3RvcmFnZS5nZXRJdGVtKCdjbGllbnQnKQogICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9KTsKCiAgICAgICAgICAgICAgY2FzZSAzOgogICAgICAgICAgICAgICAgcmVzID0gX2NvbnRleHQyLnNlbnQ7CgogICAgICAgICAgICAgICAgaWYgKCFyZXMpIHsKICAgICAgICAgICAgICAgICAgbmV3IEVycm9yKCfjgYTjgYTjga3jgpLliYrpmaTjgafjgY3jgb7jgZvjgpPjgafjgZfjgZ8nKTsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICBfdGhpczIuJGVtaXQoJ2Nvbm5lY3RDYWJsZScpOwoKICAgICAgICAgICAgICAgIF9jb250ZXh0Mi5uZXh0ID0gMTE7CiAgICAgICAgICAgICAgICBicmVhazsKCiAgICAgICAgICAgICAgY2FzZSA4OgogICAgICAgICAgICAgICAgX2NvbnRleHQyLnByZXYgPSA4OwogICAgICAgICAgICAgICAgX2NvbnRleHQyLnQwID0gX2NvbnRleHQyWyJjYXRjaCJdKDApOwogICAgICAgICAgICAgICAgY29uc29sZS5sb2coX2NvbnRleHQyLnQwKTsKCiAgICAgICAgICAgICAgY2FzZSAxMToKICAgICAgICAgICAgICBjYXNlICJlbmQiOgogICAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0Mi5zdG9wKCk7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9LCBfY2FsbGVlMiwgbnVsbCwgW1swLCA4XV0pOwogICAgICB9KSkoKTsKICAgIH0sCiAgICBzY3JvbGxUb0JvdHRvbTogZnVuY3Rpb24gc2Nyb2xsVG9Cb3R0b20oKSB7CiAgICAgIHZhciBlbGVtZW50ID0gdGhpcy4kcmVmcy5tZXNzYWdlczsKICAgICAgZWxlbWVudC5zY3JvbGxUb3AgPSBlbGVtZW50LnNjcm9sbEhlaWdodDsKICAgIH0KICB9Cn07"},{"version":3,"sources":["/Users/yanagi/chatapp/live-chat-rails/src/components/ChatWindow.vue"],"names":[],"mappings":";;AAsBA,OAAO,KAAP,MAAkB,OAAlB;AAEA,eAAe;AACb,EAAA,KAAK,EAAE,CAAC,cAAD,CADM;AAEb,EAAA,KAAK,EAAE,CAAC,UAAD,CAFM;AAGb,EAAA,IAHa,kBAGL;AACN,WAAO;AACL,MAAA,GAAG,EAAE,YAAY,CAAC,OAAb,CAAqB,KAArB;AADA,KAAP;AAGD,GAPY;AAQb,EAAA,OAAO,EAAE;AACP,IAAA,UADO,sBACK,OADL,EACc;AACnB,WAAK,IAAI,CAAA,GAAI,CAAb,EAAgB,CAAA,GAAI,OAAO,CAAC,KAAR,CAAc,MAAlC,EAA0C,CAAC,EAA3C,EAA+C;AAC7C,YAAM,IAAG,GAAI,OAAO,CAAC,KAAR,CAAc,CAAd,CAAb;;AACA,YAAI,IAAI,CAAC,KAAL,KAAe,KAAK,GAAxB,EAA6B;AAC3B,eAAK,UAAL,CAAgB,IAAI,CAAC,EAArB,EAAyB,OAAO,CAAC,EAAjC;AACA;AACF;AACF;;AACA,WAAK,UAAL,CAAgB,OAAO,CAAC,EAAxB;AACD,KAVM;AAWD,IAAA,UAXC,sBAWW,SAXX,EAWsB;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,uBAEP,KAAK,CAAC,IAAN,0CAA6C,SAA7C,aAAgE,EAAhE,EAChB;AACE,kBAAA,OAAO,EAAE;AACP,oBAAA,GAAG,EAAE,KAAI,CAAC,GADH;AAEP,oCAAgB,MAAM,CAAC,YAAP,CAAoB,OAApB,CAA4B,cAA5B,CAFT;AAGP,oBAAA,MAAM,EAAE,MAAM,CAAC,YAAP,CAAoB,OAApB,CAA4B,QAA5B;AAHD;AADX,iBADgB,CAFO;;AAAA;AAEnB,gBAAA,GAFmB;;AAWzB,oBAAI,CAAC,GAAL,EAAU;AACR,sBAAI,KAAJ,CAAU,aAAV;AACF;;AACA,gBAAA,KAAI,CAAC,KAAL,CAAW,cAAX;;AAdyB;AAAA;;AAAA;AAAA;AAAA;AAgBzB,gBAAA,OAAO,CAAC,GAAR;;AAhByB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAkB5B,KA7BM;AA8BD,IAAA,UA9BC,sBA8BU,MA9BV,EA8BkB;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,uBAEH,KAAK,CAAC,MAAN,uCAA4C,MAA5C,GAChB;AACE,kBAAA,OAAO,EAAE;AACP,oBAAA,GAAG,EAAE,MAAI,CAAC,GADH;AAEP,oCAAgB,MAAM,CAAC,YAAP,CAAoB,OAApB,CAA4B,cAA5B,CAFT;AAGP,oBAAA,MAAM,EAAE,MAAM,CAAC,YAAP,CAAoB,OAApB,CAA4B,QAA5B;AAHD;AADX,iBADgB,CAFG;;AAAA;AAEf,gBAAA,GAFe;;AAUrB,oBAAI,CAAC,GAAL,EAAU;AACR,sBAAI,KAAJ,CAAU,gBAAV;AACF;;AACA,gBAAA,MAAI,CAAC,KAAL,CAAW,cAAX;;AAbqB;AAAA;;AAAA;AAAA;AAAA;AAerB,gBAAA,OAAO,CAAC,GAAR;;AAfqB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAiBxB,KA/CM;AAgDP,IAAA,cAhDO,4BAgDW;AAChB,UAAM,OAAM,GAAI,KAAK,KAAL,CAAW,QAA3B;AACA,MAAA,OAAO,CAAC,SAAR,GAAoB,OAAO,CAAC,YAA5B;AACF;AAnDO;AARI,CAAf","sourcesContent":["<template>\n  <div class=\"chat-window\">\n    <h1>チャットウィンドウ</h1>\n    <div v-if=\"messages\" class=\"messages\" ref=\"messages\">\n      <ul v-for=\"message in messages\" :key=\"message.id\">\n        <li :class=\"{ received: message.email !== uid, sent: message.email === uid }\">\n          <span class=\"name\">{{ message.name }}</span>\n          <div class=\"message\" @dblclick=\"handleLike(message)\">\n            {{ message.content }}\n            <div v-if=\"message.likes.length\" class=\"heart-container\">\n              <font-awesome-icon icon=\"heart\" class=\"heart\" />\n              <span class=\"heart-count\">{{ message.likes.length }}</span>\n            </div>\n          </div>\n          <span class=\"created-at\">{{ message.created_at }}前</span>\n        </li>\n      </ul>\n    </div>\n  </div>\n</template>\n\n<script>\nimport axios from 'axios'\n\nexport default {\n  emits: ['connectCable'],\n  props: ['messages'],\n  data () {\n    return {\n      uid: localStorage.getItem('uid')\n    }\n  },\n  methods: {\n    handleLike (message) {\n      for (let i = 0; i < message.likes.length; i++) {\n        const like = message.likes[i]\n        if (like.email === this.uid) {\n          this.deleteLike(like.id, message.id)\n          return\n        }\n      }\n      this.createLike(message.id)\n    },\n    async createLike (messageId) {\n      try {\n        const res = await axios.post(`http://localhost:3000/messages/${messageId}/likes`, {},\n          {\n            headers: {\n              uid: this.uid,\n              \"access-token\": window.localStorage.getItem('access-token'),\n              client: window.localStorage.getItem('client')\n            }\n          })\n\n        if (!res) {\n          new Error('いいねできませんでした')\n        }\n        this.$emit('connectCable')\n      } catch (error) {\n        console.log(error)\n      }\n    },\n    async deleteLike(likeId) {\n      try {\n        const res = await axios.delete(`http://localhost:3000/likes/${likeId}`,\n          {\n            headers: {\n              uid: this.uid,\n              \"access-token\": window.localStorage.getItem('access-token'),\n              client: window.localStorage.getItem('client')\n            }\n          })\n        if (!res) {\n          new Error('いいねを削除できませんでした')\n        }\n        this.$emit('connectCable')\n      } catch (error) {\n        console.log(error)\n      }\n    },\n    scrollToBottom () {\n      const element = this.$refs.messages\n      element.scrollTop = element.scrollHeight\n    }\n  }\n}\n</script>\n\n<style scoped>\n  .chat-window {\n    background: white;\n    padding: 30px 20px;\n    border-bottom: 1px solid #eee;\n  }\n  ul {\n    list-style: none;\n    margin: 0;\n    padding: 0;\n  }\n  ul li {\n    display:inline-block;\n    clear: both;\n  }\n  .received .message {\n    background: #eee;\n    padding: 10px;\n    display: inline-block;\n    border-radius: 30px;\n    margin-bottom: 2px;\n    max-width: 400px;\n  }\n  .received {\n    float: left;\n  }\n  .sent {\n    float: right;\n  }\n  .sent .message {\n    background: #677bb4;\n    color: white;\n    padding: 10px;\n    display: inline-block;\n    border-radius: 30px;\n    margin-bottom: 2px;\n    max-width: 400px;\n  }\n  .name {\n    position: relative;\n    margin-right: 6px;\n    display: block;\n    font-size: 13px;\n  }\n  .created-at {\n    display: block;\n    color: #999;\n    font-size: 12px;\n    margin-bottom: 20px;\n    margin-left: 4px;\n  }\n  .messages {\n    max-height: 400px;\n    overflow: auto;\n  }\n  .message {\n    position: relative;\n  }\n  .heart-container {\n    background: white;\n    position: absolute;\n    display: flex;\n    justify-content: space-around;\n    align-items: center;\n    border-radius: 30px;\n    min-width: 25px;\n    border-style: solid;\n    border-width: 1px;\n    border-color: rgb(245, 245, 245);\n    padding: 1px 2px;\n    z-index: 2;\n    bottom: -7px;\n    right: 0px;\n    font-size: 9px;\n  }\n  .heart {\n    color: rgb(236, 29, 29);\n  }\n  .heart-count {\n    color: rgb(20, 19, 19);\n  }\n  .received .message::selection {\n    background: #eee;\n  }\n\n  .sent .message::selection {\n    background: #677bb4;\n  }\n</style>\n"],"sourceRoot":""}]}