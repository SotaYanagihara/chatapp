{"remainingRequest":"/Users/yanagi/programming/live-chat-vuejs/node_modules/vue-loader-v16/dist/index.js??ref--1-1!/Users/yanagi/programming/live-chat-vuejs/src/views/Chatroom.vue?vue&type=template&id=5f0fe8ed","dependencies":[{"path":"/Users/yanagi/programming/live-chat-vuejs/src/views/Chatroom.vue","mtime":1638951273544},{"path":"/Users/yanagi/programming/live-chat-vuejs/node_modules/cache-loader/dist/cjs.js","mtime":1637908768660},{"path":"/Users/yanagi/programming/live-chat-vuejs/node_modules/babel-loader/lib/index.js","mtime":1637908770962},{"path":"/Users/yanagi/programming/live-chat-vuejs/node_modules/vue-loader-v16/dist/templateLoader.js","mtime":1637908771736},{"path":"/Users/yanagi/programming/live-chat-vuejs/node_modules/cache-loader/dist/cjs.js","mtime":1637908768660},{"path":"/Users/yanagi/programming/live-chat-vuejs/node_modules/vue-loader-v16/dist/index.js","mtime":1637908768201}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:CiAgPGRpdiBjbGFzcz0iY29udGFpbmVyIj4KICAgIDxOYXZiYXIgLz4KICAgIDxDaGF0V2luZG93IEBjb25uZWN0Q2FibGU9ImNvbm5lY3RDYWJsZSIgOm1lc3NhZ2VzPSJtZXNzYWdlcyIgLz4KICAgIDxOZXdDaGF0Rm9ybSBAY29ubmVjdENhYmxlPSJjb25uZWN0Q2FibGUiLz4KICA8L2Rpdj4K"},{"version":3,"sources":["/Users/yanagi/programming/live-chat-vuejs/src/views/Chatroom.vue"],"names":[],"mappings":";EACE,CAAC,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC;IACpB,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,EAAE,CAAC;IACT,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,EAAE,CAAC;IAC/D,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC;EAC5C,CAAC,CAAC,CAAC,CAAC,CAAC","file":"/Users/yanagi/programming/live-chat-vuejs/src/views/Chatroom.vue","sourceRoot":"","sourcesContent":["<template>\n  <div class=\"container\">\n    <Navbar />\n    <ChatWindow @connectCable=\"connectCable\" :messages=\"messages\" />\n    <NewChatForm @connectCable=\"connectCable\"/>\n  </div>\n</template>\n\n<script>\nimport Navbar from '../components/Navbar'\nimport ChatWindow from '../components/ChatWindow'\nimport NewChatForm from '../components/NewChatForm'\nimport axios from 'axios'\nimport ActionCable from 'actioncable'\nexport default {\n  components: { Navbar, ChatWindow, NewChatForm },\n  data () {\n    return {\n      messages: [],\n    }\n  },\n  methods: {\n    async getMessages () {\n      try {\n        const res = await axios.get('http://localhost:3000/messages', {\n          headers: {\n            uid: window.localStorage.getItem('uid'),\n            \"access-token\": window.localStorage.getItem('access-token'),\n            client:window.localStorage.getItem('client')\n          }\n        })\n        if (!res) {\n          new Error('メッセージ一覧を取得できませんでした')\n        }\n        this.messages = res.data\n      } catch (err) {\n        console.log(err)\n      }\n    },\n\n    connectCable (message) {\n      this.messageChannel.perform('receive', {\n        message: message,\n        email: window.localStorage.getItem('uid')\n      })\n    }\n  },\n  mounted() {\n    const cable = ActionCable.createConsumer('ws://localhost:3000/cable')\n    this.messageChannel = cable.subscriptions.create('RoomChannel', {\n      connected: () => {\n        this.getMessages()\n      },\n      received: () => {\n        this.getMessages()\n      }\n    })\n  },\n  beforeUnmount () {\n    this.messageChannel.unsubscribe()\n  }\n}\n</script>\n\n<style lang=\"css\" scoped>\n</style>\n"]}]}